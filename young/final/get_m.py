import cv2
import numpy as np

# ================= ì‚¬ìš©ìžê°€ ìž…ë ¥í•´ì•¼ í•  ë°ì´í„° =================

# 1. ì¹´ë©”ë¼ í™”ë©´ìƒì—ì„œ ì°ì€ ì  4ê°œì˜ ì¢Œí‘œ (ìˆœì„œ: ì¢Œìƒ, ìš°ìƒ, ìš°í•˜, ì¢Œí•˜)
# [TIP] ê·¸ë¦¼íŒì— ì¹´ë©”ë¼ ìº¡ì³í™”ë©´ ë„ì›Œë†“ê³  ë§ˆìš°ìŠ¤ ì»¤ì„œ ê°–ë‹¤ëŒ€ì„œ ì¢Œí‘œ ë”°ì˜¤ë©´ ë¹ ë¦„!
pts_camera = np.float32([
    [209, 93],   # ì 1 (ì¢Œìƒ) í”½ì…€
    [330, 88],   # ì 2 (ìš°ìƒ) í”½ì…€
    [339, 207],  # ì 3 (ìš°í•˜) í”½ì…€
    [221, 217]   # ì 4 (ì¢Œí•˜) í”½ì…€
])

# 2. ìœ„ ì ë“¤ì— í•´ë‹¹í•˜ëŠ” ì‹¤ì œ ë¡œë´‡ ì¢Œí‘œ (mm)
# ë¡œë´‡ ëë‹¨ì„ ìœ„ ì ë“¤ì— ìœ„ì¹˜ì‹œì¼°ì„ ë•Œì˜ x, y ì¢Œí‘œ
pts_robot = np.float32([
    [0.7, -268.5],  # ì 1 ë¡œë´‡ì¢Œí‘œ
    [5.9, -193.3], # ì 2 ë¡œë´‡ì¢Œí‘œ
    [66.8, -205.4], # ì 3 ë¡œë´‡ì¢Œí‘œ
    [60.9, -269.9]   # ì 4 ë¡œë´‡ì¢Œí‘œ
])

# ==========================================================

# ë³€í™˜ í–‰ë ¬ êµ¬í•˜ê¸° (Perspective Transformation)
M = cv2.getPerspectiveTransform(pts_camera, pts_robot)

print("\n====== [ë³µì‚¬í•´ì„œ ì½”ë“œì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”] ======")
print("CALIB_MATRIX = np.array([")
print(f"    [{M[0,0]:.5f}, {M[0,1]:.5f}, {M[0,2]:.5f}],")
print(f"    [{M[1,0]:.5f}, {M[1,1]:.5f}, {M[1,2]:.5f}],")
print(f"    [{M[2,0]:.5f}, {M[2,1]:.5f}, {M[2,2]:.5f}]")
print("])")
print("==========================================\n")

# ê²€ì¦: ì 1ì„ ë„£ì—ˆì„ ë•Œ ë¡œë´‡ ì¢Œí‘œê°€ ìž˜ ë‚˜ì˜¤ëŠ”ì§€ í…ŒìŠ¤íŠ¸
test_pt = np.array([[[209, 93]]], dtype=np.float32) 
result = cv2.perspectiveTransform(test_pt, M)

print(f"ðŸŽ¯ ìž¬ê²€ì¦ ê²°ê³¼: í”½ì…€ {test_pt[0][0]} -> ë¡œë´‡ {result[0][0]}")
print(f"âœ… ì •ë‹µ(ëª©í‘œê°’): {pts_robot[0]}")